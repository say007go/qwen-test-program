<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数独（by Arthur）</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 100%;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .difficulty-selector {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            background: #f8f9fa;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .difficulty-selector:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .new-game-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .check-btn {
            background: linear-gradient(45deg, #56ab2f, #a8e063);
            color: white;
        }

        .rules-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .sudoku-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 1px;
            background: #333;
            border: 3px solid #333;
            border-radius: 5px;
            overflow: hidden;
            margin: 0 auto;
            max-width: 500px;
            width: 100%;
        }

        .cell {
            aspect-ratio: 1;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .cell:hover {
            background: #f0f0f0;
        }

        .cell.fixed {
            background: #f8f9fa;
            color: #333;
        }

        .cell.user-input {
            color: #667eea;
        }

        .cell.selected {
            background: #e3f2fd !important;
            box-shadow: inset 0 0 0 2px #667eea;
        }

        .cell.conflict {
            background: #ffebee !important;
            color: #f44336 !important;
        }

        .cell:nth-child(3n):not(:nth-child(9n)) {
            border-right: 2px solid #333;
        }

        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid #333;
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 30px;
            max-width: 300px;
            margin: 30px auto 0;
        }

        .number-btn {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .number-btn:hover {
            background: #f8f9fa;
            transform: translateY(-1px);
        }

        .number-btn.clear {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .rules-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .rules-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .rules-title {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #333;
        }

        .rules-content h3 {
            color: #667eea;
            margin: 15px 0 10px 0;
        }

        .rules-content p {
            margin: 10px 0;
            line-height: 1.6;
            color: #555;
        }

        .developer-info {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            color: #666;
            font-weight: bold;
        }

        .close-btn {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #333;
        }

        .status {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2rem;
            color: #667eea;
            font-weight: bold;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .title {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
            }

            .cell {
                font-size: 1.2rem;
            }

            .number-pad {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
            }

            .number-btn {
                padding: 12px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 1.8rem;
            }

            .cell {
                font-size: 1rem;
            }

            .sudoku-board {
                max-width: 350px;
            }
        }

        /* 按钮质感效果 */
        .btn:active, .number-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* 高亮相关单元格 */
        .cell.highlight {
            background: #e8f5e8 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">数独（by Arthur）</h1>
            <p class="subtitle">选择难度，开始挑战吧！</p>
        </div>

        <div class="controls">
            <select class="difficulty-selector" id="difficulty">
                <option value="0">简单</option>
                <option value="1" selected>中等</option>
                <option value="2">困难</option>
                <option value="3">专家</option>
                <option value="4">大师</option>
            </select>
            <button class="btn new-game-btn" onclick="generateNewGame()">新游戏</button>
            <button class="btn check-btn" onclick="checkSolution()">检查答案</button>
            <button class="btn rules-btn" onclick="showRules()">游戏规则</button>
        </div>

        <div class="status" id="status"></div>

        <div class="sudoku-board" id="sudoku-board">
            <!-- 数独格子将通过JavaScript生成 -->
        </div>

        <div class="number-pad">
            <button class="number-btn" onclick="inputNumber(1)">1</button>
            <button class="number-btn" onclick="inputNumber(2)">2</button>
            <button class="number-btn" onclick="inputNumber(3)">3</button>
            <button class="number-btn" onclick="inputNumber(4)">4</button>
            <button class="number-btn" onclick="inputNumber(5)">5</button>
            <button class="number-btn" onclick="inputNumber(6)">6</button>
            <button class="number-btn" onclick="inputNumber(7)">7</button>
            <button class="number-btn" onclick="inputNumber(8)">8</button>
            <button class="number-btn" onclick="inputNumber(9)">9</button>
            <button class="number-btn clear" onclick="clearCell()">清除</button>
        </div>
    </div>

    <div id="rulesModal" class="rules-modal">
        <div class="rules-content">
            <span class="close-btn" onclick="closeRules()">&times;</span>
            <h2 class="rules-title">数独游戏规则</h2>
            <h3>游戏目标</h3>
            <p>在9x9的格子中填入数字1-9，使得每一行、每一列和每一个3x3的小格子内都包含1-9的数字，且不重复。</p>
            
            <h3>游戏玩法</h3>
            <p>• 选择难度级别：简单、中等、困难、专家、大师</p>
            <p>• 点击空格子，然后点击数字按钮填入数字</p>
            <p>• 点击"检查答案"按钮验证当前填写是否正确</p>
            <p>• 点击"清除"按钮可以清空当前选中的格子</p>
            
            <h3>难度说明</h3>
            <p>• 简单：适合初学者，初始数字较多</p>
            <p>• 中等：适合有一定经验的玩家</p>
            <p>• 困难：挑战性增强，初始数字减少</p>
            <p>• 专家：需要高级技巧，适合熟练玩家</p>
            <p>• 大师：最高难度，极具挑战性，适合数独高手</p>
            
            <h3>技巧提示</h3>
            <p>• 观察每一行、列和3x3格子中已有的数字</p>
            <p>• 使用排除法确定空格中可能的数字</p>
            <p>• 从数字较多的区域开始填起</p>
            <p>• 遇到困难时可以点击"检查答案"找出错误</p>

            <div class="developer-info">开发者：ArthurZhu</div>
        </div>
    </div>

    <script>
        // 数独游戏逻辑
        let board = Array(9).fill().map(() => Array(9).fill(0));
        let solution = Array(9).fill().map(() => Array(9).fill(0));
        let initialBoard = Array(9).fill().map(() => Array(9).fill(0));
        let selectedCell = null;

        // 初始化游戏
        function initGame() {
            generateNewGame();
            renderBoard();
        }

        // 生成新游戏
        function generateNewGame() {
            const difficulty = parseInt(document.getElementById('difficulty').value);
            const puzzle = generateSudoku(difficulty);
            
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    board[i][j] = puzzle[i][j];
                    initialBoard[i][j] = puzzle[i][j];
                }
            }
            
            // 计算解决方案
            solution = JSON.parse(JSON.stringify(puzzle));
            solveSudoku(solution);
            
            document.getElementById('status').textContent = '';
            renderBoard();
        }

        // 渲染数独板
        function renderBoard() {
            const boardElement = document.getElementById('sudoku-board');
            boardElement.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    if (board[i][j] !== 0) {
                        cell.textContent = board[i][j];
                        if (initialBoard[i][j] !== 0) {
                            cell.classList.add('fixed');
                        } else {
                            cell.classList.add('user-input');
                        }
                    }
                    
                    cell.addEventListener('click', () => selectCell(i, j));
                    boardElement.appendChild(cell);
                }
            }
        }

        // 选择格子
        function selectCell(row, col) {
            // 清除之前的选中状态
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // 高亮相关格子
            highlightRelatedCells(row, col);
            
            // 选中当前格子（仅当不是固定数字时）
            if (initialBoard[row][col] === 0) {
                selectedCell = { row, col };
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                cell.classList.add('selected');
            }
        }

        // 高亮相关格子
        function highlightRelatedCells(row, col) {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('highlight');
            });
            
            // 高亮行和列
            for (let i = 0; i < 9; i++) {
                document.querySelector(`.cell[data-row="${row}"][data-col="${i}"]`).classList.add('highlight');
                document.querySelector(`.cell[data-row="${i}"][data-col="${col}"]`).classList.add('highlight');
            }
            
            // 高亮3x3格子
            const boxRow = Math.floor(row / 3) * 3;
            const boxCol = Math.floor(col / 3) * 3;
            for (let i = boxRow; i < boxRow + 3; i++) {
                for (let j = boxCol; j < boxCol + 3; j++) {
                    document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`).classList.add('highlight');
                }
            }
            
            // 移除当前选中格子的高亮（因为它会被选中状态覆盖）
            document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`).classList.remove('highlight');
        }

        // 输入数字
        function inputNumber(num) {
            if (!selectedCell) return;
            
            const { row, col } = selectedCell;
            if (initialBoard[row][col] !== 0) return; // 不能修改固定数字
            
            board[row][col] = num;
            renderBoard();
            selectCell(row, col); // 重新选中以保持高亮
        }

        // 清除格子
        function clearCell() {
            if (!selectedCell) return;
            
            const { row, col } = selectedCell;
            if (initialBoard[row][col] !== 0) return; // 不能清除固定数字
            
            board[row][col] = 0;
            renderBoard();
            selectCell(row, col); // 重新选中
        }

        // 检查解决方案
        function checkSolution() {
            let isComplete = true;
            let isCorrect = true;
            
            // 检查是否完成
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (board[i][j] === 0) {
                        isComplete = false;
                        break;
                    }
                }
                if (!isComplete) break;
            }
            
            // 检查是否正确
            if (isComplete) {
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        if (board[i][j] !== solution[i][j]) {
                            isCorrect = false;
                            // 高亮错误的格子
                            document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`).classList.add('conflict');
                        }
                    }
                }
            } else {
                // 检查当前填写的数字是否有冲突
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        if (board[i][j] !== 0 && !isValidPlacement(board, i, j, board[i][j])) {
                            document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`).classList.add('conflict');
                        }
                    }
                }
            }
            
            if (isComplete && isCorrect) {
                document.getElementById('status').textContent = '恭喜！数独解答正确！';
            } else if (isComplete) {
                document.getElementById('status').textContent = '数独未解答正确，请继续努力！';
            } else {
                document.getElementById('status').textContent = '数独未完成或有错误，请检查！';
            }
            
            // 2秒后移除错误高亮
            setTimeout(() => {
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.classList.remove('conflict');
                });
            }, 2000);
        }

        // 显示规则
        function showRules() {
            document.getElementById('rulesModal').style.display = 'block';
        }

        // 关闭规则
        function closeRules() {
            document.getElementById('rulesModal').style.display = 'none';
        }

        // 生成数独谜题
        function generateSudoku(difficulty) {
            // 创建一个完整的数独解决方案
            const grid = Array(9).fill().map(() => Array(9).fill(0));
            solveSudoku(grid);
            
            // 根据难度挖空
            let cellsToRemove;
            switch(difficulty) {
                case 0: cellsToRemove = 35; break;  // 简单
                case 1: cellsToRemove = 45; break;  // 中等
                case 2: cellsToRemove = 52; break;  // 困难
                case 3: cellsToRemove = 58; break;  // 专家
                case 4: cellsToRemove = 62; break;  // 大师
                default: cellsToRemove = 45;
            }
            
            // 随机挖空
            let removed = 0;
            while (removed < cellsToRemove) {
                const row = Math.floor(Math.random() * 9);
                const col = Math.floor(Math.random() * 9);
                
                if (grid[row][col] !== 0) {
                    const backup = grid[row][col];
                    grid[row][col] = 0;
                    
                    // 检查是否仍然有唯一解
                    const gridCopy = JSON.parse(JSON.stringify(grid));
                    if (countSolutions(gridCopy) !== 1) {
                        grid[row][col] = backup; // 如果不唯一则恢复
                    } else {
                        removed++;
                    }
                }
            }
            
            return grid;
        }

        // 求解数独
        function solveSudoku(grid) {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (grid[row][col] === 0) {
                        const nums = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                        // 随机打乱数组
                        for (let i = nums.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [nums[i], nums[j]] = [nums[j], nums[i]];
                        }
                        
                        for (const num of nums) {
                            if (isValidPlacement(grid, row, col, num)) {
                                grid[row][col] = num;
                                
                                if (solveSudoku(grid)) {
                                    return true;
                                }
                                
                                grid[row][col] = 0;
                            }
                        }
                        return false;
                    }
                }
            }
            return true;
        }

        // 计算解决方案数量（用于确保唯一解）
        function countSolutions(grid) {
            let count = 0;
            
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (grid[row][col] === 0) {
                        for (let num = 1; num <= 9; num++) {
                            if (isValidPlacement(grid, row, col, num)) {
                                grid[row][col] = num;
                                
                                count += countSolutions(grid);
                                
                                if (count > 1) {
                                    grid[row][col] = 0;
                                    return count;
                                }
                                
                                grid[row][col] = 0;
                            }
                        }
                        return count;
                    }
                }
            }
            
            count = 1;
            return count;
        }

        // 验证数字放置是否有效
        function isValidPlacement(grid, row, col, num) {
            // 检查行
            for (let x = 0; x < 9; x++) {
                if (x !== col && grid[row][x] === num) return false;
            }
            
            // 检查列
            for (let x = 0; x < 9; x++) {
                if (x !== row && grid[x][col] === num) return false;
            }
            
            // 检查3x3格子
            const startRow = row - (row % 3);
            const startCol = col - (col % 3);
            
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    const r = startRow + i;
                    const c = startCol + j;
                    if (r !== row && c !== col && grid[r][c] === num) return false;
                }
            }
            
            return true;
        }

        // 点击模态框外部关闭
        window.onclick = function(event) {
            const modal = document.getElementById('rulesModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // 初始化游戏
        window.onload = initGame;
    </script>
</body>
</html>